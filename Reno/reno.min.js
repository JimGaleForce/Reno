var __awaiter=this&&this.__awaiter||function(n,t,i,r){return new(i||(i=Promise))(function(u,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?u(n.value):new i(function(t){t(n.value)}).then(o,s)}e((r=r.apply(n,t||[])).next())})},__generator=this&&this.__generator||function(n,t){function e(n){return function(t){return o([n,t])}}function o(e){if(f)throw new TypeError("Generator is already executing.");while(r)try{if(f=1,u&&(i=u[e[0]&2?"return":e[0]?"throw":"next"])&&!(i=i.call(u,e[1])).done)return i;(u=0,i)&&(e=[0,i.value]);switch(e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(e[0]===6||e[0]===2)){r=0;continue}if(e[0]===3&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(e[0]===6&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(o){e=[6,o];u=0}finally{f=i=0}if(e[0]&5)throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},f,u,i;return{next:e(0),"throw":e(1),"return":e(2)}},__extends,RenoLib;(function(n){var t=function(){function t(){}return t.createSecondaryTile=function(t,i,r,u,f){return __awaiter(this,void 0,void 0,function(){var v=this,y,s,h,c,o,e,l,a;return __generator(this,function(p){switch(p.label){case 0:return y=new Date,[4,n.Utils.eval(u)];case 1:s=p.sent();h=Windows.UI.StartScreen.TileOptions.showNameOnLogo;try{c=new Windows.UI.StartScreen.SecondaryTile(i,r,r,s,h,f)}catch(w){n.Utils.error("failed to create secondary tile",w)}return o=document.getElementById(t),o?(e=o.getBoundingClientRect(),l={x:e.left,y:e.top,width:e.width,height:e.height},a=Windows.UI.Popups.Placement.above,[2,new Promise(function(t,i){try{c.requestCreateForSelectionAsync(l,a).done(function(n){n?t(!0):i(!1)})}catch(r){n.Utils.error("failed to create secondary tile",r);i(!1)}})]):(n.Utils.debug("No element to place (shall I pin a tile) question above:"+t),[2,new Promise(function(n,t){return __awaiter(v,void 0,void 0,function(){return __generator(this,function(){return t(!1),[2]})})})])}})})},t.isTilePinned=function(n){return __awaiter(this,void 0,void 0,function(){var i,t;return __generator(this,function(r){switch(r.label){case 0:return[4,Windows.UI.StartScreen.SecondaryTile.findAllForPackageAsync()];case 1:return i=r.sent(),t=!1,i.forEach(function(i){var r=i.tileId;if(r===n)return t=!0}),[2,t]}})})},t}();n.TileHelper=t})(RenoLib||(RenoLib={}));__awaiter=this&&this.__awaiter||function(n,t,i,r){return new(i||(i=Promise))(function(u,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?u(n.value):new i(function(t){t(n.value)}).then(o,s)}e((r=r.apply(n,t||[])).next())})};__generator=this&&this.__generator||function(n,t){function e(n){return function(t){return o([n,t])}}function o(e){if(f)throw new TypeError("Generator is already executing.");while(r)try{if(f=1,u&&(i=u[e[0]&2?"return":e[0]?"throw":"next"])&&!(i=i.call(u,e[1])).done)return i;(u=0,i)&&(e=[0,i.value]);switch(e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(e[0]===6||e[0]===2)){r=0;continue}if(e[0]===3&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(e[0]===6&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(o){e=[6,o];u=0}finally{f=i=0}if(e[0]&5)throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},f,u,i;return{next:e(0),"throw":e(1),"return":e(2)}},function(n){var t,i,r;(function(n){n[n.none=0]="none";n[n.log=1]="log";n[n.debug=2]="debug";n[n.error=3]="error"})(t=n.DebugType||(n.DebugType={})),function(n){n[n.text=0]="text";n[n.element=1]="element";n[n.locatorOrTextToText=2]="locatorOrTextToText"}(i=n.EvalType||(n.EvalType={}));r=function(){function n(){}return n.default=function(n){for(var t,i=[],r=1;r<arguments.length;r++)i[r-1]=arguments[r];if(typeof n!="undefined")return n;for(t=0;t<i.length;t++)if(typeof i[t]!="undefined")return i[t];return n},n.log=function(i){n.debug(i,t.log)},n.error=function(i,r){n.debug(i,t.error,r)},n.debug=function(i,r,u){r===void 0&&(r=t.debug);u===void 0&&(u=null);var f="///reno///: ";switch(r){case t.log:console.log(f+i);break;case t.debug:n.isDebugging&&console.debug(f+i);break;case t.error:console.log(f+i+": "+u);break;default:console.log(f+i)}},n.cleanText=function(n){return n.replace(/[`~!@#$%^&*()|+\-=?;:'",.<>\{\}\[\]\\\/]/gi,"_")},n.hashCode=function(n){var t=0,i,r;if(n.length===0)return t.toString();for(i=0;i<n.length;i++)r=n.charCodeAt(i),t=(t<<5)-t+r|0;return t.toString()},n.fireEvent=function(n){var t;t=document.createEvent("HTMLEvents");t.initEvent(n,!0,!0);t.eventName=n;document.dispatchEvent(t)},n.getElement=function(n){if(n instanceof HTMLElement)return n;if(typeof n=="function"&&(n=n()),typeof n!="string")return null;if(n[0]==="#")return document.getElementById(n.substring(1));var t;return t=n[0]==="."?document.getElementsByClassName(n.substring(1)):document.getElementsByTagName(n),t.length>0?t[0]:null},n.evalAs=function(t,r,u,f,e,o){return __awaiter(this,void 0,void 0,function(){var s;return __generator(this,function(h){switch(h.label){case 0:return r===i.locatorOrTextToText&&(t.length>0&&(t[0]==="#"||t[0]===".")&&(t=document.querySelector(t)),r=i.text),[4,n.eval(t,u,f,e,o)];case 1:return(s=h.sent(),r===i.text&&typeof s!="string")?(s instanceof HTMLElement&&(s=s.textContent),[2,s||""]):[2,s]}})})},n.eval=function(t,i,r,u,f){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(o){switch(o.label){case 0:if(!(typeof t=="function"))return[3,5];o.label=1;case 1:return o.trys.push([1,3,,4]),[4,t(i,r,u,f)];case 2:return[2,o.sent()];case 3:return e=o.sent(),n.error("ERROR executing: "+t,e),[2,null];case 4:return[3,6];case 5:return[2,t];case 6:return[2]}})})},n.evalNow=function(t,i,r,u,f){if(typeof t=="function")try{return t(i,r,u,f)}catch(e){return n.error("ERROR executing: "+t,e),null}else return t},n.Html2Uri=function(t,i,r){var u,e,o,f,s;for(n.debug("Html2Uri 1/6"),u=document.createElement("canvas"),u.height=r,u.width=i,e=u.getContext("2d"),typeof t=="string"&&(t=[{locator:t}]),o=[],f=0;f<t.length;f++)s=n._Html2UriDrawItem(t[f],e,i,r),s!==null&&o.push(s);var a=function(t){return n.debug("Html2Uri 3a/6"),Windows.Storage.ApplicationData.current.localFolder.createFileAsync(t,Windows.Storage.CreationCollisionOption.replaceExisting)},k=function(t){return n.debug("Html2Uri 3b/6"),Windows.Storage.ApplicationData.current.localFolder.getFileAsync(t)},v=function(t){return n.debug("Html2Uri 4/6"),t.openAsync(Windows.Storage.FileAccessMode.readWrite)},y=function(t){n.debug("Html2Uri 5/6");var i=Windows.Graphics.Imaging.BitmapEncoder.pngEncoderId;return Windows.Graphics.Imaging.BitmapEncoder.createAsync(i,t)},p=function(t){n.debug("Html2Uri 6/6");var u=e.getImageData(0,0,i,r);return t.setPixelData(Windows.Graphics.Imaging.BitmapPixelFormat.rgba8,Windows.Graphics.Imaging.BitmapAlphaMode.ignore,i,r,72,72,Array.prototype.slice.call(u.data)),t.flushAsync()},w=function(t){return n.debug("Html2Uri BBB3/6:"+t[0]),window.RenoUtilities.Utils.getUrlToLocalAsync(t[0],"_image.png")},h=function(t){return n.debug("Html2Uri 8/6:"+t),new Windows.Foundation.Uri("ms-appdata:///local/"+t)},c,l=function(){return n.debug("Html2Uri 7/6"),w(c).then(function(){return h("_image.png")})},b=function(){return h("_canvas.png")};return Promise.all(o).then(function(t){c=t;n.debug("Html2Uri 2/6");try{return a("_canvas.png").then(v).then(y).then(p).then(b,l)}catch(i){return n.debug("Html2Uri error",i),l}})},n._Html2UriGetAndDraw=function(t,i,r,u){return function(t){n.debug("Html2Uri 4/6");var f=Windows.Graphics.Imaging.BitmapEncoder.pngEncoderId;return Windows.Graphics.Imaging.BitmapEncoder.createAsync(f,t).then(function(t){n.debug("Html2Uri 5/6");try{var f=i.getImageData(0,0,r,u);return t.setPixelData(Windows.Graphics.Imaging.BitmapPixelFormat.rgba8,Windows.Graphics.Imaging.BitmapAlphaMode.ignore,r,u,72,72,Array.prototype.slice.call(f.data)),t.flushAsync()}catch(e){return n.error("getImageData/encoder issue",e),null}})}},n._Html2UriDrawItem=function(t,i,r,u){var f=r,e=u,o=function(){return n.eval(t.locator)},s=function(i){return new Promise(function(r,u){var f=n.getElement(i);if(!f)return n.debug("no logo/image found: "+t.locator),u(),null;n.debug("got logo: "+t.locator);r(f)})},h=function(o){return new Promise(function(s){var v=0,y=0,h=o,l=function(){return null},w=h.tagName,p=h.currentStyle||window.getComputedStyle(h),c,a;if(p&&(c=p.backgroundImage.slice(4,-1)),c&&(h=document.createElement("img")),a=function(){var i=e/h.height,o=f/h.width,s=n.default(t.stretch,"Uniform"),c;s==="Uniform"?(c=Math.abs(i-1)<Math.abs(o-1),c?(f=h.width*i,v=(r-f)/2):(e=h.height*o,y=(u-e)/2)):s==="Fill"},l=function(){return i.drawImage(h,v,y,f,e)},c){h.onload=function(){a();l();s(h.src)};h.src=c;return}h.tagName==="IMG"&&(a(),l());s(h.src)})};return o().then(s).then(h)},n.Retrieve=function(t){var i=this;return new Promise(function(r){return __awaiter(i,void 0,void 0,function(){var i;return __generator(this,function(u){switch(u.label){case 0:return(typeof RenoUtilities!="undefined")?(n.debug("about to Retrieve("+t+")"),[4,window.RenoUtilities.Utils.getUrlAsync(t)]):[3,2];case 1:return i=u.sent(),n.debug("got it:"+i),r(i),[3,3];case 2:n.debug("retrieve-unresolved!");u.label=3;case 3:return[2]}})})})},n.Extract=function(t,i,r,u,f){var e;return new Promise(function(o,s){var b,c,v,l,h,p,k,a,w;if(i==="xml"){try{b=(new DOMParser).parseFromString(f,"application/xml")}catch(y){n.error("extract",y)}e=b}else e=f;c=t.indexOf(":attr(");v=null;c>-1&&(l=t.indexOf(")",c),l>-1&&(v=t.substr(c+6,l-c-6),t=t.substr(0,c)+(t.length>l+1?t.substr(l+1):"")));h=null;try{h=e.querySelector(t)}catch(y){return n.error("FS: selector failed: "+t+" : ",y),null}if(h===null)return n.debug("FS: no matching selections: "+t),null;if(v!==null&&(h=h.getAttributeNode(v)),r==="text"&&(h=h.textContent,h.indexOf("CDATA")>-1&&(p=h.lastIndexOf("["),k=h.indexOf("]"),h=h.substr(p+1,k-p-1))),typeof u=="undefined"||u===null)return n.debug("found : "+h),o(h),!0;a=!1;w=u.replace("value",'"'+h+'"');try{a=!u||eval(w)}catch(y){console.error("err: ("+w+")",y);a=!0}return n.debug("found : "+h),a?o(h):s(h),a})},n.Share=function(n){var t=Windows.ApplicationModel.DataTransfer.DataTransferManager.getForCurrentView();n.ondatarequested&&(t.ondatarequested=function(t){n.ondatarequested(t,n)});n.ontargetapplicationchosen&&(t.ontargetapplicationchosen=function(t){n.ontargetapplicationchosen(t,n)});Windows.ApplicationModel.DataTransfer.DataTransferManager.showShareUI()},n}();r.isDebugging=!1;n.Utils=r}(RenoLib||(RenoLib={})),function(n){var i=function(){function n(){this.type=t.custom}return n.prototype.activate=function(){},n.prototype.deactivate=function(){},n.prototype.pageChanged=function(){},n.prototype.refresh=function(){},n}(),t;n.Activity=i,function(n){n[n.custom=0]="custom";n[n.AppBar=1]="AppBar";n[n.AppTile=2]="AppTile";n[n.ShareTarget=3]="ShareTarget";n[n.Speech=4]="Speech"}(t=n.ActivityType||(n.ActivityType={}))}(RenoLib||(RenoLib={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),__awaiter=this&&this.__awaiter||function(n,t,i,r){return new(i||(i=Promise))(function(u,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?u(n.value):new i(function(t){t(n.value)}).then(o,s)}e((r=r.apply(n,t||[])).next())})},__generator=this&&this.__generator||function(n,t){function e(n){return function(t){return o([n,t])}}function o(e){if(f)throw new TypeError("Generator is already executing.");while(r)try{if(f=1,u&&(i=u[e[0]&2?"return":e[0]?"throw":"next"])&&!(i=i.call(u,e[1])).done)return i;(u=0,i)&&(e=[0,i.value]);switch(e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(e[0]===6||e[0]===2)){r=0;continue}if(e[0]===3&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(e[0]===6&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(o){e=[6,o];u=0}finally{f=i=0}if(e[0]&5)throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},f,u,i;return{next:e(0),"throw":e(1),"return":e(2)}},RenoLib;(function(n){var t=function(t){function i(i){var r=t.call(this)||this,u=r._default();return r.protocol=i.protocol,r.id=i.id,r.name=i.name,r.isDebugging=i.debug,r.onActivated=i.onActivated,r.fullScreen=i.fullScreen,r.title=i.title||u.title,r.logo=i.logo||"img",n.Utils.isDebugging=r.isDebugging,r}return __extends(i,t),i.prototype._activate=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(i){switch(i.label){case 0:return t=Windows.UI.ViewManagement.ApplicationView.getForCurrentView(),[4,n.Utils.eval(this.title)];case 1:return t.title=i.sent(),[2]}})})},i.prototype._default=function(){return{title:function(){return document.title}}},i}(n.Activity);n.AppInfo=t})(RenoLib||(RenoLib={}));__awaiter=this&&this.__awaiter||function(n,t,i,r){return new(i||(i=Promise))(function(u,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?u(n.value):new i(function(t){t(n.value)}).then(o,s)}e((r=r.apply(n,t||[])).next())})};__generator=this&&this.__generator||function(n,t){function e(n){return function(t){return o([n,t])}}function o(e){if(f)throw new TypeError("Generator is already executing.");while(r)try{if(f=1,u&&(i=u[e[0]&2?"return":e[0]?"throw":"next"])&&!(i=i.call(u,e[1])).done)return i;(u=0,i)&&(e=[0,i.value]);switch(e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(e[0]===6||e[0]===2)){r=0;continue}if(e[0]===3&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(e[0]===6&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(o){e=[6,o];u=0}finally{f=i=0}if(e[0]&5)throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},f,u,i;return{next:e(0),"throw":e(1),"return":e(2)}},function(n){var t=function(){function t(i){var r=t._defaultById(i.id);n.Utils.debug("(new) adopting from existing cmd:"+i.id);this.adopt(i,r)}return t.prototype.adopt=function(t,i){i===void 0&&(i=this);this.show=n.Utils.default(t.show,i.show);this.text=n.Utils.default(t.text,i.text);this.command=n.Utils.default(t.command,i.command);this.id=n.Utils.default(t.id,i.id);this.icon=n.Utils.default(t.icon,i.icon);this.options=n.Utils.default(i.options,t.options);this.options.args=n.Utils.default(t.options&&t.options.args,i.options.args);this.options.ondatarequested=n.Utils.default(t.options&&t.options.ondatarequested,i.options.ondatarequested);this.options.title=n.Utils.default(t.options&&t.options.title,i.options.title);this.options.text=n.Utils.default(t.options&&t.options.text,i.options.text);this.options.tileId=n.Utils.default(t.options&&t.options.tileId,i.options.tileId);this.options.tileImage=n.Utils.default(t.options&&t.options.tileImage,i.options.tileImage)},t._defaultById=function(n){switch(n){case"ShareCommand":return t._defaultShareCommand();case"PinCommand":return t._defaultPinCommand();case"UnpinCommand":return t._defaultUnpinCommand();default:return t._default()}},t._default=function(){return{show:!0,icon:"help",options:{args:""}}},t._defaultPinCommand=function(){var t=this;return{id:"PinCommand",text:n.Utils.default(n.Reno.instance.appInfo.name,n.Reno.instance.appInfo.id,"pin"),icon:"",options:{tileImage:n.Utils.default(n.Reno.instance.appInfo.logo,"img"),args:function(){return document.URL},tileId:document.URL},show:function(i,r,u){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,n.TileHelper.isTilePinned(u.appInfo.id+"."+n.Utils.hashCode(i.options.tileId))];case 1:return[2,!t.sent()]}})})},command:function(i,r,u,f){n.Utils.debug("tile:0:command");var e=n.Utils.Html2Uri([{locator:r.options.tileImage,stretch:"Uniform"}],150,150).then(function(i){return __awaiter(t,void 0,void 0,function(){var h=this,t,e,o,s;return __generator(this,function(c){switch(c.label){case 0:n.Utils.debug("tile:1:logo created");c.label=1;case 1:return c.trys.push([1,3,,4]),e=(t=n.TileHelper).createSecondaryTile,o=[r.id,f.appInfo.id+"."+n.Utils.hashCode(r.options.tileId)],[4,n.Utils.evalAs(r.text,n.EvalType.locatorOrTextToText,document.URL)];case 2:return e.apply(t,o.concat([c.sent(),document.URL,i])).then(function(t){return __awaiter(h,void 0,void 0,function(){var r;return __generator(this,function(f){switch(f.label){case 0:return!t?(n.Utils.debug("tile failed: deleting logo"),[4,Windows.Storage.ApplicationData.current.localFolder.getFileAsync(i.toString())]):[3,3];case 1:return r=f.sent(),[4,r.deleteAsync()];case 2:f.sent();f.label=3;case 3:return u.refresh(),[2]}})})}),[3,4];case 3:return s=c.sent(),n.Utils.error("tile failed",s),[3,4];case 4:return[2]}})})});return}}},t._defaultUnpinCommand=function(){var t=this;return{id:"UnpinCommand",text:"Unpin",icon:"",options:{args:function(){return document.URL},tileId:document.URL},show:function(i,r,u){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,n.TileHelper.isTilePinned(u.appInfo.id+"."+n.Utils.hashCode(i.options.tileId))];case 1:return[2,t.sent()]}})})},command:function(i,r,u,f){return __awaiter(t,void 0,void 0,function(){var e=this,t,i;return __generator(this,function(o){switch(o.label){case 0:return t=new Windows.UI.StartScreen.SecondaryTile(f.appInfo.id+"."+n.Utils.hashCode(r.options.tileId)),[4,t.requestDeleteAsync()];case 1:return(i=o.sent(),!i)?[3,3]:[4,u.refresh()];case 2:return o.sent(),window.setTimeout(function(){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,u.refresh()];case 1:return n.sent(),[2]}})})},250),[3,3];case 3:return[2]}})})}}},t._defaultShareCommand=function(){return{id:"ShareCommand",text:"Share",icon:"",show:!0,options:{title:document.title,text:"Check this out! "+document.location.href,ondatarequested:function(t,i){t.request.data.properties.title=n.Utils.evalNow(i.title,document.URL);t.request.data.setText(n.Utils.evalNow(i.text,document.URL))}},command:function(t,i){n.Utils.Share(i.options)}}},t}();n.AppBarCommand=t}(RenoLib||(RenoLib={}));var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),__awaiter=this&&this.__awaiter||function(n,t,i,r){return new(i||(i=Promise))(function(u,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?u(n.value):new i(function(t){t(n.value)}).then(o,s)}e((r=r.apply(n,t||[])).next())})},__generator=this&&this.__generator||function(n,t){function e(n){return function(t){return o([n,t])}}function o(e){if(f)throw new TypeError("Generator is already executing.");while(r)try{if(f=1,u&&(i=u[e[0]&2?"return":e[0]?"throw":"next"])&&!(i=i.call(u,e[1])).done)return i;(u=0,i)&&(e=[0,i.value]);switch(e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(e[0]===6||e[0]===2)){r=0;continue}if(e[0]===3&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(e[0]===6&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(o){e=[6,o];u=0}finally{f=i=0}if(e[0]&5)throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},f,u,i;return{next:e(0),"throw":e(1),"return":e(2)}},RenoLib;(function(n){var t=function(t){function i(i){var r=t.call(this)||this;return r.type=n.ActivityType.AppBar,r.load(i),r}return __extends(i,t),i.prototype.load=function(t){var r=this._default(),i;if(this.show=n.Utils.default(t.show,r.appBar.show,!0),this.commands=n.Utils.default(t.commands,r.appBar.commands,[]),t.commands&&t.keepDefaultCommands)for(i=0;i<r.appBar.commands.length;i++)this.commands.splice(i,0,r.appBar.commands[i])},i.prototype.activate=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return n.Utils.eval(this.show,this,n.Reno.instance)?[4,this.create()]:[3,2];case 1:return t.sent(),[3,3];case 2:n.Utils.debug("appbar show was false");t.label=3;case 3:return[2]}})})},i.prototype.create=function(){return __awaiter(this,void 0,void 0,function(){var f=this,r,u,t,i;return __generator(this,function(e){switch(e.label){case 0:for(n.Utils.debug("appBar-creating"),r=document.createElement("div"),r.className="reno",r.id="commandbar",this.buttons=[],u=function(){for(var s,e,u=null,o=0;o<t.buttons.length;o++)t.buttons[o].id===t.commands[i].id&&(u=t.buttons[o]);s=u!==null;s?(n.Utils.debug("adopting from existing cmd:"+t.commands[i].id),u.adopt(t.commands[i])):(n.Utils.debug("adding new cmd:"+t.commands[i].id),u=new n.AppBarCommand(t.commands[i]),t.buttons.push(u),e=document.createElement("button"),e.className="commandbutton reno",e.textContent=u.icon,e.id=u.id,e.onclick=function(t){u.command(t,u,f,n.Reno.instance)},r.appendChild(e))},t=this,i=0;i<this.commands.length;i++)u();return document.body.appendChild(r),[4,this.refresh()];case 1:return e.sent(),[2]}})})},i.prototype.refresh=function(){return __awaiter(this,void 0,void 0,function(){var t,i,u,r;return __generator(this,function(f){switch(f.label){case 0:t=0;f.label=1;case 1:return(t<this.buttons.length)?(i=document.getElementById(this.buttons[t].id),u=i.className.indexOf(" hidden")>-1,[4,n.Utils.eval(this.buttons[t].show,this.buttons[t],this,n.Reno.instance)]):[3,4];case 2:r=f.sent();r||n.Utils.debug("appbarcmd ("+this.buttons[t].id+") show was false");u===r&&(r?i.className=i.className.replace(" hidden",""):i.className+=" hidden");f.label=3;case 3:return t++,[3,1];case 4:return[2]}})})},i.prototype._default=function(){return{appBar:{show:!0,commands:[n.AppBarCommand._defaultPinCommand(),n.AppBarCommand._defaultUnpinCommand(),n.AppBarCommand._defaultShareCommand()]}}},i}(n.Activity);n.AppBar=t})(RenoLib||(RenoLib={}));__extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(t){function i(n){var i=t.call(this)||this;return i.load(n),i}return __extends(i,t),i.prototype.load=function(t){var i=this._default();this.tileImage=n.Utils.default(t.tileImage,i.tileImage);this.tileText=n.Utils.default(t.tileText,i.tileText);this.tileText.formatType=n.Utils.default(this.tileText.formatType,"text");this.tileText.uri&&typeof this.tileText.type=="undefined"&&this.tileText.uri.indexOf("rss")>-1&&(this.tileText.type="rss");this.tileText.type&&this.tileText.type==="rss"&&(this.tileText.type="xml",this.tileText.locator=n.Utils.default(this.tileText.locator,"item>title"));this.durationSeconds=n.Utils.default(t.durationSeconds,i.durationSeconds);this.repeat=n.Utils.default(t.repeat,i.repeat)},i.prototype.activate=function(){var n=this;this.renderText().then(function(t){var i=Windows.UI.Notifications,o=i.TileTemplateType.tileWideImageAndText01,r=i.TileUpdateManager.getTemplateContent(o),s=r.getElementsByTagName("text"),f,u,e;s[0].appendChild(r.createTextNode(t));f=r.getElementsByTagName("image");f[0].attributes.src=n.tileImage;u=new i.TileNotification(r);e=new Date;u.expirationTime=new Date(e.getTime()+n.durationSeconds*1e3);i.TileUpdateManager.createTileUpdaterForApplication().update(u);n.repeat&&window.setTimeout(function(){n.activate()},n.durationSeconds*1e3)})},i.prototype.renderText=function(){var t=this;return new Promise(function(i){t.tileText.uri?n.Utils.Retrieve(t.tileText.uri).then(function(r){i(n.Utils.Extract(t.tileText.locator,t.tileText.type,t.tileText.formatType,null,r))}):i(t.tileText)})},i.prototype._default=function(){var t=document.getElementsByTagName("img");return{tileImage:n.Utils.default(n.Reno.instance.appInfo.logo,"img"),tileText:n.Utils.default(n.Reno.instance.appInfo.name,n.Reno.instance.appInfo.id,""),durationSeconds:86400,repeat:!0}},i}(n.Activity);n.AppTile=t}(RenoLib||(RenoLib={}));__extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var t=function(t){function i(i){var r=t.call(this)||this;return r.type=n.ActivityType.ShareTarget,r.shareOperation=null,r.onShareReady=n.Utils.default(i.onShareReady,r.onShareReady),r}return __extends(i,t),i.prototype.shareReady=function(n){if(this.shareOperation=n,this.onShareReady)this.onShareReady(this.shareOperation)},i.prototype._default=function(){return{onShareReady:function(n){var t=n.data.properties.title,i=n.data.properties.description,r=n.data.properties.packageFamilyName}}},i}(n.Activity);n.ShareTarget=t}(RenoLib||(RenoLib={}));__extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(n){var i=function(t){function i(i){var r=t.call(this)||this;return r.type=n.ActivityType.Speech,r.load(i),r}return __extends(i,t),i.prototype.load=function(){},i.prototype.activate=function(){var n=this;window.setInterval(function(){return n._tick()},500);this._requestMicrophonePermission().then(function(t){t&&n.initializeRecognizer()},function(n){var t=new Windows.UI.Popups.MessageDialog(n.message,"Exception");t.showAsync()})},i.prototype._deactivate=function(){},i.prototype._tick=function(){},i.prototype.initializeRecognizer=function(t){t===void 0&&(t=!1);n.Utils.debug("initializeRecognizer");typeof this.recognizer!="undefined"&&(this.recognizer=null);try{this.recognizer=new Windows.Media.SpeechRecognition.SpeechRecognizer}catch(i){n.Utils.debug("failed to start speech recognition:"+i.toString());return}!t},i.prototype._requestMicrophonePermission=function(){return new Promise(function(n,t){var i,r,u;try{i=new Windows.Media.Capture.MediaCaptureInitializationSettings;i.streamingCaptureMode=Windows.Media.Capture.StreamingCaptureMode.audio;r=new Windows.Media.Capture.MediaCapture;r.initializeAsync(i).then(function(){n(!0)},function(i){if(i.number===-2147024891)n(!1);else if(i.number===-1072845856){var r=new Windows.UI.Popups.MessageDialog("No Audio Capture devices are present on this system.");r.showAsync();n(!1)}else t(i)})}catch(f){if(f.number===-2147221164)return u=new Windows.UI.Popups.MessageDialog("Media Player components not available on this system."),u.showAsync(),!1}})},i}(n.Activity),t;n.Speech=i,function(n){n[n.NotReady=0]="NotReady";n[n.Ready=1]="Ready";n[n.Speaking=2]="Speaking";n[n.Paused=3]="Paused"}(t||(t={}))}(RenoLib||(RenoLib={}));__awaiter=this&&this.__awaiter||function(n,t,i,r){return new(i||(i=Promise))(function(u,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?u(n.value):new i(function(t){t(n.value)}).then(o,s)}e((r=r.apply(n,t||[])).next())})};__generator=this&&this.__generator||function(n,t){function e(n){return function(t){return o([n,t])}}function o(e){if(f)throw new TypeError("Generator is already executing.");while(r)try{if(f=1,u&&(i=u[e[0]&2?"return":e[0]?"throw":"next"])&&!(i=i.call(u,e[1])).done)return i;(u=0,i)&&(e=[0,i.value]);switch(e[0]){case 0:case 1:i=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++;u=e[1];e=[0];continue;case 7:e=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&&i[i.length-1])&&(e[0]===6||e[0]===2)){r=0;continue}if(e[0]===3&&(!i||e[1]>i[0]&&e[1]<i[3])){r.label=e[1];break}if(e[0]===6&&r.label<i[1]){r.label=i[1];i=e;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(e);break}i[2]&&r.ops.pop();r.trys.pop();continue}e=t.call(n,r)}catch(o){e=[6,o];u=0}finally{f=i=0}if(e[0]&5)throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},f,u,i;return{next:e(0),"throw":e(1),"return":e(2)}},function(n){var t=function(){function t(i){i===void 0&&(i=window.RenoActivatedArgs);var r=this;if(t.instance=this,i){n.Utils.debug("ACTIVATED INDIRECT");this.onActivated(i)}window.addEventListener("focus",function(){r.refresh()});this.addExpectedBehaviors()}return t.Load=function(i){try{var r=window.Reno=new t;return r.addAppInfo(i),r.addAbilities(i.abilities),r.activate(),!0}catch(u){return n.Utils.error("Reno failed to load",u),!1}},t.prototype.addExpectedBehaviors=function(){},t.prototype.onActivated=function(t){var r,u,i;t&&(this.appInfo&&this.appInfo.onActivated&&(r=n.Utils.eval(this.appInfo.onActivated,t),r)||t.detail&&t.detail.length!==0&&(t.detail[0].kind===Windows.ApplicationModel.Activation.ActivationKind.shareTarget&&(u=this.abilities.find(function(t){return t.type===n.ActivityType.ShareTarget}),u),t.detail[0].kind===Windows.ApplicationModel.Activation.ActivationKind.launch&&(i=t.detail[0].arguments,n.Utils.debug("launch-args:"+i),i.indexOf("http")===0&&(n.Utils.debug("launch-nav:"+i),document.addEventListener("RenoActivate",function(){document.location.href=i}),document.location.href=i,n.Utils.debug("launch-navd:"+i)))))},t.prototype.refresh=function(){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(){for(n=0;n<this.abilities.length;n++)this.abilities[n].refresh();return[2]})})},t.prototype.addAbilities=function(t){this.abilities=[];t.appBar&&this.abilities.push(new n.AppBar(t.appBar));t.appTile&&this.abilities.push(new n.AppTile(t.appTile));t.speech&&this.abilities.push(new n.Speech(t.speech))},t.prototype.addAppInfo=function(t){this.appInfo=new n.AppInfo(t);this.appInfo.isDebugging&&(n.Utils.isDebugging=this.appInfo.isDebugging)},t.prototype.activate=function(){var t=this;try{n.Utils.fireEvent("RenoActivate");this.appInfo&&this.appInfo._activate();document.readyState==="complete"||document.readyState==="loaded"||document.readyState==="interactive"?this._activate():document.addEventListener("DOMContentLoaded",function(){t._activate()})}catch(i){n.Utils.error("main activate failed",i)}},t.prototype._activate=function(){for(var n=0;n<this.abilities.length;n++)this.abilities[n].activate()},t}();n.Reno=t}(RenoLib||(RenoLib={}));
//# sourceMappingURL=reno.min.js.map